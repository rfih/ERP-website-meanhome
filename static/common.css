:root{
  --primary:#007bff; --primary-dark:#0069d9;
  --success:#28a745; --danger:#dc3545; --warning:#ffc107;
  --muted:#6c757d; --bg:#ededf0; --border:#e9ecef;
}

/* Base */
body{font-family:Arial,sans-serif;background:var(--bg);margin:20px;font-size:14px}
h1,h2{color:#333;margin:0 0 8px}
nav a{margin-right:15px;font-weight:bold;color:#333;text-decoration:none;font-size:15px}

/* Layout */
.layout{display:flex;min-height:100vh;gap:16px}
.sidebar{
  width:280px;background:#fff;border-right:1px solid var(--border);
  padding:14px;position:sticky;top:0;height:calc(100vh - 40px);overflow:auto;
}
.content{flex:1;min-width:0;padding:0 16px}
.brand{font-weight:700;font-size:16px;margin-bottom:6px}

/* Sidebar form */
.sbm{display:grid;grid-template-columns:1fr;gap:6px}
.sbm input[type="text"],.sbm select,.sbm input[type="date"]{padding:6px 10px;font-size:13px;height:32px;width:100%}
.sbm .row{display:flex;gap:6px}
.caption{color:var(--muted);font-size:12px}

/* Sidebar toggle / overlay */
.hamburger{display:inline-flex;align-items:center;gap:6px;position:sticky;top:10px;margin-bottom:10px;z-index:6}
.overlay{display:none;pointer-events:none}
@media (max-width:900px){
  .sidebar{position:fixed;left:-300px;top:0;height:100vh;z-index:20;transition:left .2s ease}
  .sidebar.open{left:0}
  .overlay.show{display:block;position:fixed;inset:0;background:rgba(0,0,0,.2);z-index:15}
}
@media (min-width:901px){
  body.sb-collapsed .sidebar{
    flex:0 0 0 !important;flex-basis:0 !important;width:0 !important;
    padding:0 !important;margin:0 !important;border:0 !important;overflow:hidden !important;pointer-events:none !important;
  }
  body.sb-collapsed .content{padding-left:0 !important}
}

/* Toolbar */
.page-header{display:flex;align-items:center;justify-content:space-between;margin:6px 0 8px}
.page-header .left{display:flex;align-items:center;gap:12px}
.page-header .right{color:#6b7280;font-size:12px;white-space:nowrap}
.toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:6px 0 12px}
.toolbar .group{display:flex;align-items:center;gap:8px}

/* Buttons */
.btn{padding:10px 12px;border:0;border-radius:4px;color:#fff;background:var(--primary);cursor:pointer}
.btn:hover{background:var(--primary-dark)}
.btn.gray{background:#6c757d}
.btn.red{background:var(--danger)}
.btn.outline{background:#fff;color:var(--primary);border:1px solid var(--primary)}

/* Tables */
table{width:100%;border-collapse:collapse;background:#fff;border-radius:6px;overflow:hidden;margin-top:12px}
th,td{border:1px solid #ddd;padding:10px 12px;text-align:center}
thead th{background:var(--primary);color:#fff;border-color:var(--primary-dark);font-weight:600}
tbody tr:nth-child(even) td{background:#f8fafc}

/* Progress */
.progress-bar{width:100%;height:10px;background:#e0e0e0;border-radius:6px;overflow:hidden}
.progress-fill{height:100%;background:var(--success);transition:width .3s}
.progress-fill.running{
  position:relative;
  background-image:linear-gradient(45deg,rgba(255,255,255,.25) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.25) 50%,rgba(255,255,255,.25) 75%,transparent 75%,transparent);
  background-size:16px 16px;animation:prog-stripes 1s linear infinite
}
@keyframes prog-stripes{from{background-position:0 0}to{background-position:16px 0}}

/* Row highlight */
tr.is-running{outline:2px solid var(--warning);outline-offset:-2px}

/* Actions column */
.actions-col{min-width:300px;white-space:normal;overflow:visible}
.actions-group{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.actions-group .btn{flex:0 0 auto}

/* Print */
.print-only{display:none;font-size:12px;color:#666}
.screen-only{display:block}
.print-label{display:none;font-size:10px;color:#999}
@media print{
  .screen-only,.sidebar,.hamburger,.toolbar,.page-header,.overlay,nav,form,.no-print{display:none !important}
  body{background:#fff;margin:0;padding:10px;font-size:12px}
  table{border-radius:0}
  th,td{font-size:12px;border:1px solid #999;padding:6px}
  .progress-bar{display:none}
  .print-only{display:table-cell !important;border:1px solid #999;min-height:10px}
  .print-label{display:block}
  @page{margin:10mm}
}
/* Make the whole modal box-size sane */
.orders-page .modal, .orders-page .modal * { box-sizing: border-box; }

/* Body scroll only vertical; no sideways scroll */
.orders-page .m-body{
  max-height: calc(88vh - 56px - 56px); /* total - header - footer */
  overflow-y: auto;
  overflow-x: hidden;     /* <- fixes the inner horizontal bar */
  padding-right: 6px;     /* space for vertical scrollbar */
}

/* 2-col grid on desktop, 1-col on mobile */
.orders-page .form-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px 12px; }
.orders-page .form-grid .full{ grid-column: 1 / -1; }

@media (max-width: 900px){
  .orders-page .form-grid{ grid-template-columns: 1fr; }
}

/* Consistent control look (shared with Stations too if you like) */
input[type="text"], input[type="number"], input[type="date"], select, textarea{
  background:#fff; border:1px solid #ced4da; border-radius:6px;
  padding:8px 10px; height:34px; font-size:13px;
}
textarea{ height:96px; resize:vertical; }
input:focus, select:focus, textarea:focus{
  outline:0; border-color:var(--primary); box-shadow:0 0 0 2px rgba(0,123,255,.15);
}

/* --- Sidebar overflow fix --- */
.sidebar, .sidebar * { box-sizing: border-box; }   /* key line */
.sidebar { overflow-x: hidden; }                    /* no horizontal bar */

/* Make sidebar controls fill without spilling */
.sidebar .sbm input[type="text"],
.sidebar .sbm input[type="date"],
.sidebar .sbm select,
.sidebar .sbm textarea,
.sidebar .sbm .btn {
  width: 100%;
  max-width: 100%;
  min-width: 0;
}

/* Date row: two fields side-by-side without overflow */
.sidebar .sbm .row { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
@media (max-width: 360px){
  .sidebar .sbm .row { grid-template-columns: 1fr; }  /* stack on tiny screens */
}

/* Optional: tidy the search card */
.sidebar .card { background:#fff; border:1px solid var(--border); border-radius:8px; padding:10px; }
.sidebar .card + .card { margin-top:10px; }

/* ---- Stations table polish ---- */
.stations-page .table-wrap{ overflow:auto; border-radius:6px; background:#fff; }
.stations-page table{ width:max-content; min-width:100%; border-collapse:collapse; }

.stations-page thead th{
  position:sticky; top:0; z-index:5;
  background:var(--primary); color:#fff; border-color:var(--primary-dark);
}

.stations-page thead th.actions-col{
  background: var(--primary) !important;
  color: #fff !important;
  border-color: var(--primary-dark) !important;
}

.stations-page th.actions-col,
.stations-page td.actions-col{
  position:sticky; right:0; z-index:4; /* keep frozen col readable over scroll */
  box-shadow: none;   /* small divider to the left */
}

/* tighter rows without looking cramped */
.stations-page th, .stations-page td{ padding:8px 10px; }
.stations-page tbody tr:nth-child(even) td{ background:#f8fafc; }

/* long text should wrap, not force horizontal scroll */
.stations-page .wrap{ white-space:normal; word-break:break-word; }

/* notes box smaller by default */
.stations-page .cell-notes textarea{ 
  width: 100%;
  min-height: 56px;
  box-sizing: border-box;
  overflow-x: hidden;     /* <- kills that tiny horizontal bar */
  overflow-y: auto;
  resize: vertical;
}

/* compact buttons */
.stations-page .btn.sm{ padding:6px 8px; font-size:12px; }

/* Effective due: keep to one line, put source under it in small text */
.stations-page .due-main{ font-weight:600; }
.stations-page .due-sub{ display:block; font-size:12px; color:#6c757d; line-height:1.2; }

/* numbers centered */
.stations-page .num{ text-align:center; }

/* prevent any sidebar/input from creating horizontal scroll */
.sidebar, .sidebar *{ box-sizing:border-box; }
.sidebar{ overflow-x:hidden; }

.print-only { display: none !important; }
@media print {
  .print-only  { display: table-cell !important; }
  .print-label { display: block !important; }
  .screen-only { display: none !important; }
}
/* 1) NOTES column (10th) — stop the “offside” and inner X-scroll */
.stations-page thead th:nth-child(10),
.stations-page tbody td:nth-child(10){
  width: 150px;          /* tweak: 240–320px to taste */
  max-width: 150px;
}

.stations-page tbody td:nth-child(10){ padding-right: 8px; }

.stations-page tbody td:nth-child(10) textarea{
  display: block;
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
  margin: 0;
  height: auto;
  min-height: 30px;
  overflow-x: hidden;     /* kill the tiny horizontal bar */
  overflow-y: auto;
  resize: vertical;
}

/* 2) Keep the Actions header blue like the others */
.stations-page thead th.actions-col{
  background: var(--primary) !important;
  color: #fff !important;
  border-color: var(--primary-dark) !important;
}

/* 3) (Safety) make sure table cells use border-box so widths don't spill */
.stations-page table,
.stations-page th,
.stations-page td{ box-sizing: border-box; }

/* Stations: 已完成 column (11th) */
.stations-page thead th:nth-child(11),
.stations-page tbody td:nth-child(11){
  width: 110px;          /* <-- column width */
  max-width: 110px;
  text-align: center;
  box-sizing: border-box;
}

/* The number input inside 已完成 */
.stations-page tbody td:nth-child(11) input[type="number"]{
  width: 80px;           /* <-- input box width */
  height: 32px;          /* <-- input box height */
  text-align: center;
  box-sizing: border-box;
  font-variant-numeric: tabular-nums;
}

/* ---- Stations modals ---- */
.stations-page .modal{
  display:none;
  position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  z-index:1001;
  background:#fff; border:1px solid var(--border); border-radius:10px;
  width:min(820px,96vw); max-height:88vh; box-shadow:0 18px 40px rgba(0,0,0,.35);
}
.stations-page .modal.open{ display:block; }

.stations-page .modal-overlay{
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,.45); backdrop-filter: blur(2px);
  z-index:1000;
}
.stations-page .modal-overlay.open{ display:block; }

.stations-page .m-header{ padding:12px 16px; font-weight:700; border-bottom:1px solid var(--border); }
.stations-page .m-body{ padding:14px 16px; overflow:auto; max-height:calc(88vh - 56px - 56px); }
.stations-page .m-footer{ padding:10px 16px; border-top:1px solid var(--border); display:flex; gap:8px; justify-content:flex-end; position:sticky; bottom:0; background:#fff; }

body.modal-open{ overflow:hidden; } /* prevent background scroll when a modal is open */

/* ===== Stations print layout (final) ===== */
@media print {
  @page { size: A4 landscape; margin: 10mm; }

  /* make the table fill the sheet */
  .stations-page table { width: 100% !important; table-layout: fixed !important; border-collapse: collapse !important; font-size: 12px; }
  .stations-page th, .stations-page td { border: 1.5pt solid #000; padding: 6px; color: #000; }

  /* show the print-only columns and hide screen-only bits */
  .print-only  { display: table-cell !important; }
  .screen-only { display: none !important; }

  /* hide UI chrome on paper */
  .toolbar, .sidebar, .hamburger, .task-status, .actions-group { display: none !important; }

  /* HIDE columns you don't want on paper:
     1=Progress, 4=Effective due, 11=已完成, 13=最後更新, 14=Actions, 15=checkbox(if exists)
     (indexes based on your stations table header order)
  */
  .stations-page thead th:nth-child(1),
  .stations-page tbody td:nth-child(1),
  .stations-page thead th:nth-child(4),
  .stations-page tbody td:nth-child(4),
  .stations-page thead th:nth-child(11),
  .stations-page tbody td:nth-child(11),
  .stations-page thead th:nth-child(13),
  .stations-page tbody td:nth-child(13),
  .stations-page thead th.actions-col,
  .stations-page tbody td.actions-col,
  .stations-page thead th input[type="checkbox"],
  .stations-page tbody td input[type="checkbox"] {
    display: none !important;
  }

  /* Notes: print plain text, not the textarea */
  .stations-page tbody td:nth-child(10) textarea { display: none !important; }
  .stations-page tbody td:nth-child(10) .print-note { display: block !important; white-space: pre-wrap; }

  /* optional: tidy column widths for a balanced sheet */
  .stations-page thead th:nth-child(2),    /* 客戶交期 */   .stations-page tbody td:nth-child(2)  { width: 22mm; }
  .stations-page thead th:nth-child(3),    /* 預計出貨 */   .stations-page tbody td:nth-child(3)  { width: 22mm; }
  .stations-page thead th:nth-child(5),    /* 製令號碼 */   .stations-page tbody td:nth-child(5)  { width: 28mm; }
  .stations-page thead th:nth-child(6),    /* 專案名稱 */   .stations-page tbody td:nth-child(6)  { width: 55mm; }
  .stations-page thead th:nth-child(7),    /* 產品名稱 */   .stations-page tbody td:nth-child(7)  { width: 24mm; }
  .stations-page thead th:nth-child(8),    /* 製令數量 */   .stations-page tbody td:nth-child(8)  { width: 20mm; text-align:center; }
  .stations-page thead th:nth-child(9),    /* 作業內容 */   .stations-page tbody td:nth-child(9)  { width: 28mm; }
  .stations-page thead th:nth-child(10) { width: 58mm; }    /* 注意事項 */
  .stations-page thead th:nth-child(12),   /* 剩下=計劃數量 */.stations-page tbody td:nth-child(12) { width: 18mm; text-align:center; }
  /* three extra print columns (良品 / 不良品 / 生產總時間) */
  .stations-page thead th.print-only, .stations-page tbody td.print-only { width: 22mm; text-align:center; }
  
  /* make inputs look like plain text on paper */
  input, select, textarea { background: transparent !important; border: 0 !important; box-shadow: none !important; outline: 0 !important; }
}
